<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>–ß–∞—à–∫–∞ –∫–æ—Ñ–µ ‚òïÔ∏è</title>
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://unpkg.com/@heroicons/v2"></script>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
</head>
<body>
<div id="app" class="min-h-screen bg-gradient-to-b from-amber-50 to-rose-50">
    <!-- –®–∞–ø–∫–∞ —Å –∞–Ω–∏–º–∞—Ü–∏–µ–π -->
    <header class="sticky top-0 bg-white/80 backdrop-blur-md shadow-sm z-50">
        <div class="container mx-auto px-4 py-3 flex items-center justify-between">
            <h1 class="text-2xl font-bold text-rose-800">‚òïÔ∏è –ß–∞—à–∫–∞ –∫–æ—Ñ–µ</h1>
            <button @click="openCart" 
                    class="relative p-2 rounded-full bg-rose-100 hover:bg-rose-200 transition">
                <svg class="w-6 h-6 text-rose-800" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                          d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13L5.4 5M7 13l-2.293 2.293c-.63.63-.184 1.707.707 1.707H17m0 0a2 2 0 100 4 2 2 0 000-4zm-8 2a2 2 0 11-4 0 2 2 0 014 0z"/>
                </svg>
                <span v-if="cartTotalCount > 0" 
                      class="absolute -top-1 -right-1 bg-rose-600 text-white rounded-full w-5 h-5 text-xs flex items-center justify-center">
                    {{ cartTotalCount }}
                </span>
            </button>
        </div>
    </header>

    <!-- –ü–µ—Ä—Å–æ–Ω–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ø—Ä–∏–≤–µ—Ç—Å—Ç–≤–∏–µ -->
    <section class="container mx-auto px-4 py-6">
        <div class="bg-white rounded-2xl p-6 shadow-lg">
            <h2 class="text-xl font-semibold text-gray-800 mb-2">
                üëã –î–æ–±—Ä–æ –ø–æ–∂–∞–ª–æ–≤–∞—Ç—å, {{ userName }}!
            </h2>
            <p class="text-gray-600">–í—ã–±–µ—Ä–∏—Ç–µ –≤–∞—à –ª—é–±–∏–º—ã–π –∫–æ—Ñ–µ</p>
        </div>
    </section>

    <!-- –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Å –≥–æ—Ä–∏–∑–æ–Ω—Ç–∞–ª—å–Ω—ã–º —Å–∫—Ä–æ–ª–ª–æ–º -->
    <section class="container mx-auto px-4 py-4">
        <div class="flex space-x-3 overflow-x-auto pb-4">
            <button v-for="category in categories" 
                    @click="selectCategory(category)"
                    :class="{'bg-rose-800 text-white': selectedCategory === category, 
                            'bg-white text-gray-800': selectedCategory !== category}"
                    class="px-4 py-2 rounded-full whitespace-nowrap transition-all shadow-sm">
                {{ category }}
            </button>
        </div>
    </section>

    <!-- –°–µ—Ç–∫–∞ —Ç–æ–≤–∞—Ä–æ–≤ -->
    <main class="container mx-auto px-4 py-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <article v-for="product in filteredProducts" 
                     class="bg-white rounded-xl p-4 shadow-md hover:shadow-lg transition">
                <img :src="product.image" 
                     class="w-full h-48 object-cover rounded-lg mb-4" 
                     alt="Coffee">
                <h3 class="font-semibold text-lg mb-2">{{ product.name }}</h3>
                <p class="text-gray-600 text-sm mb-4">{{ product.description }}</p>
                
                <div class="flex items-center justify-between">
                    <span class="text-rose-800 font-bold">{{ product.price }} ‚ÇΩ</span>
                    <button @click="addToCart(product)" 
                            class="bg-rose-100 text-rose-800 px-4 py-2 rounded-full flex items-center 
                                   hover:bg-rose-200 transition">
                        <svg class="w-5 h-5 mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" 
                                  d="M12 4v16m8-8H4"/>
                        </svg>
                        –î–æ–±–∞–≤–∏—Ç—å
                    </button>
                </div>
            </article>
        </div>
    </main>

    <!-- –ú–æ–¥–∞–ª—å–Ω–æ–µ –æ–∫–Ω–æ –∫–æ—Ä–∑–∏–Ω—ã -->
    <div v-if="showCart" class="fixed inset-0 bg-black/50 z-50 flex items-end">
        <div class="bg-white w-full rounded-t-2xl p-6 max-h-[80vh] overflow-y-auto animate-slide-up">
            <div class="flex justify-between items-center mb-6">
                <h2 class="text-2xl font-bold">–ö–æ—Ä–∑–∏–Ω–∞</h2>
                <button @click="showCart = false" class="text-gray-500 hover:text-gray-700">
                    ‚úï
                </button>
            </div>

            <div v-if="cart.length === 0" class="text-center py-8 text-gray-500">
                –ö–æ—Ä–∑–∏–Ω–∞ –ø—É—Å—Ç–∞
            </div>

            <div v-else>
                <div v-for="item in cart" class="flex items-center justify-between mb-4">
                    <div>
                        <h3 class="font-semibold">{{ item.product.name }}</h3>
                        <div class="flex items-center space-x-2 mt-1">
                            <button @click="updateQuantity(item, -1)" 
                                    class="w-8 h-8 rounded-full bg-rose-100 text-rose-800">
                                -
                            </button>
                            <span class="w-8 text-center">{{ item.quantity }}</span>
                            <button @click="updateQuantity(item, 1)" 
                                    class="w-8 h-8 rounded-full bg-rose-100 text-rose-800">
                                +
                            </button>
                        </div>
                    </div>
                    <span class="text-rose-800 font-bold">
                        {{ item.product.price * item.quantity }} ‚ÇΩ
                    </span>
                </div>

                <div class="border-t pt-4 mt-4">
                    <div class="flex justify-between mb-4">
                        <span class="font-semibold">–ò—Ç–æ–≥–æ:</span>
                        <span class="text-rose-800 font-bold">{{ cartTotal }} ‚ÇΩ</span>
                    </div>
                    <button @click="checkout" 
                            class="w-full bg-rose-800 text-white py-3 rounded-xl font-semibold
                                   hover:bg-rose-900 transition">
                        –û—Ñ–æ—Ä–º–∏—Ç—å –∑–∞–∫–∞–∑
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
const { createApp } = Vue;

createApp({
    data() {
        return {
            showCart: false,
            selectedCategory: '–í—Å–µ',
            categories: ['–í—Å–µ', '–ö–æ—Ñ–µ', '–ß–∞–π', '–î–µ—Å–µ—Ä—Ç—ã', '–°–µ–∑–æ–Ω–Ω–æ–µ'],
            products: [
                {
                    id: 1,
                    name: '–ö–∞–ø—É—á–∏–Ω–æ –ü—Ä–µ–º–∏—É–º',
                    category: '–ö–æ—Ñ–µ',
                    price: 350,
                    description: '–ò–¥–µ–∞–ª—å–Ω—ã–π –±–∞–ª–∞–Ω—Å —ç—Å–ø—Ä–µ—Å—Å–æ –∏ –º–æ–ª–æ—á–Ω–æ–π –ø–µ–Ω—ã',
                    image: 'https://images.unsplash.com/photo-1582515073490-39981397c445?w=400'
                },
                // ... –¥—Ä—É–≥–∏–µ —Ç–æ–≤–∞—Ä—ã
            ],
            cart: [],
            userData: {}
        }
    },
    computed: {
        filteredProducts() {
            return this.selectedCategory === '–í—Å–µ' 
                ? this.products 
                : this.products.filter(p => p.category === this.selectedCategory);
        },
        cartTotal() {
            return this.cart.reduce((sum, item) => sum + (item.product.price * item.quantity), 0);
        },
        cartTotalCount() {
            return this.cart.reduce((sum, item) => sum + item.quantity, 0);
        },
        userName() {
            return this.userData?.user?.first_name || '–ì–æ—Å—Ç—å';
        }
    },
    methods: {
        addToCart(product) {
            const existing = this.cart.find(item => item.product.id === product.id);
            if (existing) {
                existing.quantity++;
            } else {
                this.cart.push({ product, quantity: 1 });
            }
        },
        updateQuantity(item, delta) {
            item.quantity += delta;
            if (item.quantity < 1) {
                this.cart = this.cart.filter(i => i !== item);
            }
        },
        async checkout() {
            try {
                const result = await Telegram.WebApp.openInvoice({
                    title: `–ó–∞–∫–∞–∑ –≤ "–ß–∞—à–∫–∞ –∫–æ—Ñ–µ"`,
                    description: `–¢–æ–≤–∞—Ä–æ–≤: ${this.cartTotalCount}`,
                    currency: 'RUB',
                    prices: [{
                        label: '–ò—Ç–æ–≥–æ',
                        amount: this.cartTotal * 100
                    }]
                });

                if (result === 'paid') {
                    await this.sendOrderToServer();
                    Telegram.WebApp.showAlert('–ó–∞–∫–∞–∑ —É—Å–ø–µ—à–Ω–æ –æ–ø–ª–∞—á–µ–Ω!');
                    this.cart = [];
                    this.showCart = false;
                }
            } catch (error) {
                Telegram.WebApp.showAlert('–û—à–∏–±–∫–∞ –æ–ø–ª–∞—Ç—ã: ' + error.message);
            }
        },
        async sendOrderToServer() {
            // –†–µ–∞–ª—å–Ω–∞—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –±—ç–∫–µ–Ω–¥–æ–º
            const orderData = {
                user: this.userData,
                items: this.cart,
                total: this.cartTotal
            };
            console.log('Order sent:', orderData);
        }
    },
    mounted() {
        Telegram.WebApp.ready();
        Telegram.WebApp.expand();
        this.userData = Telegram.WebApp.initDataUnsafe;
    }
}).mount('#app');
</script>

<style>
@keyframes slide-up {
    from { transform: translateY(100%); }
    to { transform: translateY(0); }
}

.animate-slide-up {
    animation: slide-up 0.3s ease-out;
}

/* –ö–∞—Å—Ç–æ–º–Ω—ã–µ —Å—Ç–∏–ª–∏ –¥–ª—è —Å–∫—Ä–æ–ª–ª–∞ */
::-webkit-scrollbar {
    width: 6px;
    height: 6px;
}

::-webkit-scrollbar-track {
    background: rgba(0,0,0,0.05);
}

::-webkit-scrollbar-thumb {
    background: rgba(0,0,0,0.2);
    border-radius: 3px;
}
</style>
</body>
</html>